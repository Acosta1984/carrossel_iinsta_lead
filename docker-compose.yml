# API de Criativos (Gemini). Com Traefik: sem ports no host (evita conflito "port already allocated");
# Traefik acessa o container pela rede. Crie .env no servidor com GEMINI_API_KEY (e CREATIVES_BASE_URL).
services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    image: carrossel_iinsta_lead:latest
    container_name: carrossel-insta-api
    restart: unless-stopped

    # Crie .env no mesmo diret√≥rio do compose com GEMINI_API_KEY=xxx (Compose carrega automaticamente).
    # Sem mapeamento de porta: Traefik roteia pela rede. Se precisar acessar direto na porta 3000, descomente:
    # ports:
    #   - "3000:3000"

    environment:
      NODE_ENV: production
      PORT: 3000
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      STORAGE_PROVIDER: ${STORAGE_PROVIDER:-local}
      STORAGE_LOCAL_PATH: /app/storage/creatives
      CREATIVES_BASE_URL: ${CREATIVES_BASE_URL:-http://localhost:3000/creatives-static}
      LOG_LEVEL: ${LOG_LEVEL:-info}

    volumes:
      - creatives_storage:/app/storage/creatives

volumes:
  creatives_storage:
